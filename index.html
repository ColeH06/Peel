<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Peel</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../static/css/styles.css">
</head>
<body>

    <!-- Sticky Dark Green Banner -->
    <div class="header">
        <img src="../static/img/peel-logo.png" alt="Peel Logo" class="logo">
    </div>

    <!-- Slogan Below the Logo -->
    <img src="../static/img/peel-slogan.png" alt="Peel Slogan" class="slogan">

    <!-- Tagline Below the Slogan -->
    <p class="tagline">
    Save time and money — Peel helps you find the <br>
    best prices online in just seconds.
    </p>

    <img src="../static/img/peel-image.png" alt="Peel Image" class="peel-image">

    <!-- Login & Signup Buttons -->
    <div class="button-container">
        <button class="login-button" id="login-btn">Login</button>
        <button class="signup-button" id="signup-btn">Create Free Account</button>
    </div>

    <!-- Popup for Login / Signup -->
    <div class="popup-container" id="popup-container">
        <div class="popup">
            <button class="close-btn" id="close-popup">✖</button>
            <h2 id="popup-title">Login</h2>
            <input type="email" id="email" class="input-field" placeholder="Email">
            <input type="password" id="password" class="input-field" placeholder="Password">
            <button id="popup-action" class="popup-button"></button>
            <button class="social-button google" id="google-login"><img src="../static/img/google-icon.png"> Continue with Google</button>
            <button class="social-button microsoft" id="microsoft-login"><img src="../static/img/microsoft-icon.png"> Continue with Microsoft</button>
        </div>
    </div>

    <!-- Firebase Authentication -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, OAuthProvider } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        let auth; // Declare globally

        async function initializeFirebase() {
            const response = await fetch("/firebase-config");
            if (!response.ok) throw new Error("Failed to load Firebase config.");
            const firebaseConfig = await response.json();
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);

            document.getElementById("login-btn").onclick = () => openPopup('login');
            document.getElementById("signup-btn").onclick = () => openPopup('signup');
            document.getElementById("google-login").onclick = () => handleGoogleLogin();
            document.getElementById("microsoft-login").onclick = () => handleMicrosoftLogin();
            document.getElementById("popup-action").onclick = () => handleAuthAction();
            document.getElementById("close-popup").onclick = () => closePopup();
        }

        initializeFirebase();

        function openPopup(type) {
            document.getElementById('popup-container').style.display = 'flex';
            document.getElementById('popup-title').innerText = type === 'login' ? "Login" : "Create Account";
            document.getElementById('popup-action').innerText = type === 'login' ? "Login" : "Sign Up";
            document.getElementById('popup-action').onclick = type === 'login' ? handleLogin : handleSignup;
        }

        function closePopup() {
            document.getElementById('popup-container').style.display = 'none';
        }

        async function handleLogin() {
            await signInWithEmailAndPassword(auth, email.value, password.value);
            window.location.href = "/chatbot";
        }

        async function handleSignup() {
            await createUserWithEmailAndPassword(auth, email.value, password.value);
            window.location.href = "/chatbot";
        }

        async function handleGoogleLogin() {
            await signInWithPopup(auth, new GoogleAuthProvider());
            window.location.href = "/chatbot";
        }

        async function handleMicrosoftLogin() {
            await signInWithPopup(auth, new OAuthProvider("microsoft.com"));
            window.location.href = "/chatbot";
        }
    </script>

</body>
</html>
